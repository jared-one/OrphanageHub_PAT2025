# CONFIGURATION QUERY OUTPUT
Generated: 2025-09-15 23:32:29
Directory: /home/jared/OrphanageHub_PAT2025/src/main/java/com/orphanagehub/service
================================================================================

------------------------------------------------------------
File: DonorService.java
Size: 23207 bytes
```java
package com.orphanagehub.service;

import com.orphanagehub.dao.*;
import com.orphanagehub.model.*;
import io.vavr.collection.List;
import io.vavr.control.Option;
import io.vavr.control.Try;
import org.locationtech.jts.geom.Coordinate;
import org.locationtech.jts.geom.GeometryFactory;
import org.locationtech.jts.geom.Point;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.time.LocalDateTime;

/**
 * Enhanced donor service with complete donation management.
 * 
 * @author OrphanageHub Team
 * @version 2.0
 * @since 2025-09-06
 */
public class DonorService {
    private static final Logger logger = LoggerFactory.getLogger(DonorService.class);
    
    private final DonationDAO donationDAO = new DonationDAO();
    private final DonationItemDAO itemDAO = new DonationItemDAO();
    private final OrphanageDAO orphanageDAO = new OrphanageDAO();
    private final ResourceRequestDAO requestDAO = new ResourceRequestDAO();
    private final NotificationDAO notificationDAO = new NotificationDAO();
    private final AuditLogDAO auditLogDAO = new AuditLogDAO();
    private final UserDAO userDAO = new UserDAO();
    
    private final GeometryFactory geometryFactory = new GeometryFactory();
    
    /**
     * Makes a monetary donation
     */
    public Try<Donation> makeMonetaryDonation(MonetaryDonationRequest request, Integer donorId) {
        // Validate amount
        if (request.amount() <= 0) {
            return Try.failure(new ServiceException("Donation amount must be positive"));
        }
        
        if (request.amount() > 1000000) {
            return Try.failure(new ServiceException("Donation amount exceeds maximum limit"));
        }
        
        // Create donation
        Donation donation = Donation.createMonetary(
            donorId,
            request.orphanageId(),
            request.amount(),
            request.paymentMethod()
        );
        
        // Add optional fields
        donation = new Donation(
            null,
            donation.donorId(),
            donation.orphanageId(),
            request.requestId().map(id -> id),
            donation.donationType(),
            donation.amount(),
            donation.currency(),
            Option.none(),
            Option.none(),
            Option.none(),
            donation.estimatedValue(),
            donation.donationDate(),
            request.scheduledDate().map(date -> date),
            donation.status(),
            donation.paymentMethod(),
            Option.none(), // Transaction ref set after payment
            request.taxDeductible(),
            request.anonymous(),
            request.recurring(),
            request.recurring() ? Option.of(request.recurrenceInterval()) : Option.none(),
            Option.none(), // Next recurrence calculated after first payment
            Option.of(request.donorMessage()),
            false,
            Option.none(),
            Option.none(),
            false,
            Option.of(request.notes()),
            LocalDateTime.now(),
            Option.none(),
            Option.none()
        );
        
        return donationDAO.create(donation)
            .flatMap(created -> {
                // Process payment
                return processPayment(created, request.paymentDetails())
                    .flatMap(transactionRef -> {
                        // Update donation with transaction reference
                        return donationDAO.markCompleted(created.donationId(), transactionRef)
                            .flatMap(v -> {
                                // Update resource request if applicable
                                if (created.requestId().isDefined()) {
                                    updateResourceRequest(created);
                                }
                                
                                // Notify orphanage
                                notifyOrphanageAboutDonation(created);
                                
                                // Create tax receipt if eligible
                                if (created.taxDeductible()) {
                                    generateTaxReceipt(created);
                                }
                                
                                // Schedule recurring if applicable
                                if (created.recurringDonation()) {
                                    scheduleRecurringDonation(created);
                                }
                                
                                // Log donation
                                auditLogDAO.logSuccess(donorId, null, AuditLog.ACTION_DONATE,
                                    "Donation", created.donationId().toString());
                                
                                logger.info("Monetary donation {} completed", created.donationId());
                                return donationDAO.findById(created.donationId())
                                    .flatMap(opt -> opt.toTry(() -> 
                                        new ServiceException("Donation not found
*(truncated)*
```

------------------------------------------------------------
File: VolunteerService.java
Size: 13151 bytes
```java
package com.orphanagehub.service;

import com.orphanagehub.dao.*;
import com.orphanagehub.model.*;
import io.vavr.collection.List;
import io.vavr.control.Option;
import io.vavr.control.Try;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.time.LocalDateTime;

/**
 * Service for volunteer operations.
 * 
 * @author OrphanageHub Team
 * @version 2.0
 * @since 2025-09-06
 */
public class VolunteerService {
    private static final Logger logger = LoggerFactory.getLogger(VolunteerService.class);
    
    private final VolunteerOpportunityDAO opportunityDAO = new VolunteerOpportunityDAO();
    private final VolunteerApplicationDAO applicationDAO = new VolunteerApplicationDAO();
    private final UserDAO userDAO = new UserDAO();
    private final OrphanageDAO orphanageDAO = new OrphanageDAO();
    private final NotificationDAO notificationDAO = new NotificationDAO();
    private final AuditLogDAO auditLogDAO = new AuditLogDAO();
    
    /**
     * Searches volunteer opportunities
     */
    public Try<List<VolunteerOpportunity>> searchOpportunities(OpportunitySearchCriteria criteria) {
        return opportunityDAO.findOpenOpportunities()
            .map(opportunities -> {
                List<VolunteerOpportunity> filtered = opportunities;
                
                // Filter by category
                if (criteria.category() != null) {
                    filtered = filtered.filter(o -> o.category().equals(criteria.category()));
                }
                
                // Filter by skills
                if (criteria.skills() != null && !criteria.skills().isEmpty()) {
                    filtered = filtered.filter(o -> 
                        o.skillsRequired().map(skills ->
                            criteria.skills().exists(skill ->
                                skills.toLowerCase().contains(skill.toLowerCase())
                            )
                        ).getOrElse(true)
                    );
                }
                
                // Filter by time commitment
                if (criteria.maxHoursPerWeek() != null) {
                    filtered = filtered.filter(o ->
                        o.hoursPerWeek().map(hours -> 
                            hours <= criteria.maxHoursPerWeek()
                        ).getOrElse(true)
                    );
                }
                
                // Filter by location
                if (criteria.city() != null || criteria.province() != null) {
                    filtered = filterByLocation(filtered, criteria.city(), criteria.province());
                }
                
                // Filter by age eligibility
                if (criteria.volunteerAge() != null) {
                    filtered = filtered.filter(o -> o.isAgeEligible(criteria.volunteerAge()));
                }
                
                // Sort
                if (criteria.sortBy() != null) {
                    filtered = sortOpportunities(filtered, criteria.sortBy());
                }
                
                return filtered;
            });
    }
    
    /**
     * Applies for volunteer opportunity
     */
    public Try<VolunteerApplication> applyForOpportunity(
            Integer opportunityId, Integer volunteerId,
            ApplicationDetails details) {
        
        // Check if already applied
        return applicationDAO.hasApplied(volunteerId, opportunityId)
            .flatMap(hasApplied -> {
                if (hasApplied) {
                    return Try.failure(new ServiceException("You have already applied for this opportunity"));
                }
                
                // Get opportunity details
                return opportunityDAO.findById(opportunityId)
                    .flatMap(oppOpt -> oppOpt.toTry(() -> 
                        new ServiceException("Opportunity not found")))
                    .flatMap(opportunity -> {
                        // Check if opportunity is open
                        if (!opportunity.isOpen()) {
                            return Try.failure(new ServiceException("This opportunity is no longer available"));
                        }
                        
                        // Check age eligibility
                        userDAO.findById(volunteerId).forEach(userOpt -> {
                            userOpt.forEach(user -> {
                                user.dateOfBirth().forEach(dob -> {
                                    int age = java.time.Period.between(dob, java.time.LocalDate.now()).getYears();
                                    if (!opportunity.isAgeEligible(age)) {
                                        throw new RuntimeException("You do not meet the age requirements");
                                    }
                                });
                            });
                        });
                        
                        // Create application
                        VolunteerApplication application = VolunteerApplication.create(
                            opportunityId,
                         
*(truncated)*
```

------------------------------------------------------------
File: AdminService.java
Size: 17595 bytes
```java
package com.orphanagehub.service;

import com.orphanagehub.dao.*;
import com.orphanagehub.model.*;
import io.vavr.collection.List;
import io.vavr.control.Option;
import io.vavr.control.Try;
import net.sf.jasperreports.engine.*;
import net.sf.jasperreports.engine.export.JRPdfExporter;
import net.sf.jasperreports.export.SimpleExporterInput;
import net.sf.jasperreports.export.SimpleOutputStreamExporterOutput;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.File;
import java.io.FileOutputStream;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.HashMap;
import java.util.Map;

/**
 * Complete admin service with all management functions.
 * 
 * @author OrphanageHub Team
 * @version 2.0
 * @since 2025-09-06
 */
public class AdminService {
    private static final Logger logger = LoggerFactory.getLogger(AdminService.class);
    
    private final UserDAO userDAO = new UserDAO();
    private final OrphanageDAO orphanageDAO = new OrphanageDAO();
    private final DonationDAO donationDAO = new DonationDAO();
    private final ResourceRequestDAO requestDAO = new ResourceRequestDAO();
    private final VolunteerOpportunityDAO opportunityDAO = new VolunteerOpportunityDAO();
    private final VolunteerApplicationDAO applicationDAO = new VolunteerApplicationDAO();
    private final NotificationDAO notificationDAO = new NotificationDAO();
    private final AuditLogDAO auditLogDAO = new AuditLogDAO();
    
    /**
     * Gets system dashboard statistics
     */
    public Try<SystemStatistics> getSystemStatistics() {
        return Try.of(() -> {
            // User statistics
            int totalUsers = userDAO.findAllActive().map(List::size).getOrElse(0);
            int donors = userDAO.findByRole("Donor").map(List::size).getOrElse(0);
            int volunteers = userDAO.findByRole("Volunteer").map(List::size).getOrElse(0);
            int orphanageStaff = userDAO.findByRole("OrphanageRep").map(List::size).getOrElse(0);
            
            // Orphanage statistics
            int totalOrphanages = orphanageDAO.findAllVerified().map(List::size).getOrElse(0);
            int pendingVerifications = orphanageDAO.findByVerificationStatus("Pending")
                .map(List::size).getOrElse(0);
            
            // Donation statistics
            double totalDonations = donationDAO.getTotalDonations().getOrElse(0.0);
            int monthlyDonations = donationDAO.getMonthlyDonationCount().getOrElse(0);
            
            // Request statistics
            int openRequests = requestDAO.findOpenRequests().map(List::size).getOrElse(0);
            int urgentRequests = requestDAO.findUrgentRequests().map(List::size).getOrElse(0);
            
            // Volunteer statistics
            int activeOpportunities = opportunityDAO.findOpenOpportunities()
                .map(List::size).getOrElse(0);
            int pendingApplications = applicationDAO.getPendingApplicationCount().getOrElse(0);
            
            return new SystemStatistics(
                totalUsers,
                donors,
                volunteers,
                orphanageStaff,
                totalOrphanages,
                pendingVerifications,
                totalDonations,
                monthlyDonations,
                openRequests,
                urgentRequests,
                activeOpportunities,
                pendingApplications
            );
        });
    }
    
    /**
     * Manages user account (activate/suspend/delete)
     */
    public Try<Void> manageUserAccount(Integer userId, String action, Integer adminId, String reason) {
        return userDAO.findById(userId)
            .flatMap(userOpt -> userOpt.toTry(() -> 
                new ServiceException("User not found")))
            .flatMap(user -> {
                User updated = switch (action.toLowerCase()) {
                    case "activate" -> user.withAccountStatus("Active");
                    case "suspend" -> user.withAccountStatus("Suspended");
                    case "delete" -> user.withAccountStatus("Deleted");
                    default -> throw new ServiceException("Invalid action: " + action);
                };
                
                return userDAO.update(updated)
                    .flatMap(u -> {
                        // Send notification to user
                        String message = "Your account has been " + action.toLowerCase() + "d";
                        if (reason != null) {
                            message += ". Reason: " + reason;
                        }
                        
                        Notification notification = Notification.create(
                            userId,
                            Notification.TYPE_SYSTEM,
                            "Account Status Changed",
                            message,
                            Notification.PRIORITY_HIGH
                        );
                        notificationDAO.create(notification);
                        
                        // Log action
                      
*(truncated)*
```

------------------------------------------------------------
File: OrphanageService.java
Size: 3185 bytes
```java
package com.orphanagehub.service;

import com.orphanagehub.dao.OrphanageDAO;
import com.orphanagehub.dao.ResourceRequestDAO;
import com.orphanagehub.dao.VolunteerOpportunityDAO;
import com.orphanagehub.model.Orphanage;
import com.orphanagehub.model.ResourceRequest;
import com.orphanagehub.model.VolunteerOpportunity;
import com.orphanagehub.util.ValidationUtil;
import io.vavr.collection.List;
import io.vavr.control.Try;

/**
 * Service for orphanage-related operations.
 * Manages profiles, requests, and opportunities.
 */
public class OrphanageService {

    private final OrphanageDAO orphanageDAO = new OrphanageDAO();
    private final ResourceRequestDAO requestDAO = new ResourceRequestDAO();
    private final VolunteerOpportunityDAO opportunityDAO = new VolunteerOpportunityDAO();

    /**
     * Creates or updates an orphanage profile.
     * @param orphanage The Orphanage to save.
     * @return Try<Void> - success on save, failure on error.
     */
    public Try<Void> saveProfile(Orphanage orphanage) {
        return orphanageDAO.findById(orphanage.orphanageId())
                .flatMap(opt -> opt.isDefined() ? orphanageDAO.update(orphanage).map(o -> (Void) null) : orphanageDAO.create(orphanage).map(o -> (Void) null));
    }

    /**
     * Adds or edits a resource request.
     * @param request The ResourceRequest to manage.
     * @return Try<Void> - success on operation, failure on error.
     */
    public Try<Void> manageResourceRequest(ResourceRequest request) {
        return Try.of(() -> {
                    if (request.quantityNeeded() <= 0) {
                        throw new IllegalArgumentException("Quantity needed must be positive");
                    }
                    return true;
                })
                .flatMap(valid -> (request.requestId() != null && !request.requestId().isEmpty()) ? requestDAO.update(request) : requestDAO.create(request));
    }

    /**
     * Gets all requests for an orphanage.
     * @param orphanageId The ID to filter.
     * @return Try<List<ResourceRequest>> - immutable list of requests.
     */
    public Try<List<ResourceRequest>> getRequests(String orphanageId) {
        return requestDAO.findByOrphanageId(orphanageId);
    }

    /**
     * Posts or manages a volunteer opportunity.
     * @param opportunity The VolunteerOpportunity to post.
     * @return Try<Void> - success on post, failure on error.
     */
    public Try<Void> manageVolunteerOpportunity(VolunteerOpportunity opportunity) {
        return (opportunity.opportunityId() != null && !opportunity.opportunityId().isEmpty()) ? 
            opportunityDAO.update(opportunity) : 
            opportunityDAO.create(opportunity);
    }

    // Additional: Acknowledge donation (Phase 1) - update request fulfilled
    public Try<Void> acknowledgeDonation(String requestId, int fulfilledAmount) {
        return requestDAO.findById(requestId)
                .flatMap(optReq -> optReq.toTry(() -> new IllegalArgumentException("Request not found")))
                .<ResourceRequest>map(req -> req.withQuantityFulfilled(req.quantityFulfilled() + fulfilledAmount))
                .flatMap(requestDAO::update);
    }
}
```

================================================================================
Total: 4 files